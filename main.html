<!DOCTYPE html>
<html lang="ru">
<head>
	<title>Музыкальный плеер</title>
	<!-- Подключаем стили -->
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<!-- Создаем контейнер для плеера -->
	<div class="container">
		<h1>Музыкальный плеер</h1>
		<audio id="audio-player"></audio>
        <!-- Форма поиска -->
        <form id="search-form">
            <label for="search-input">Введите название песни:</label>
	        <input id="search-input" type="text" name="search" placeholder="Название трека">
	        <button type="submit">Найти</button>
        </form>
        <!-- Список треков -->
        <ul id="song-list">
	        <!-- Здесь будут отображаться треки с сервера -->
        </ul>
		<!-- Создаем кнопки управления плеером -->
        <div id="control-buttons">
            <button id="play-button">Play</button>
            <button id="pause-button">Pause</button>
            <button id="stop-button">Stop</button>
        </div>
	</div>
	<!-- Подключаем скрипты -->
	<script>
		// Создаем объект Audio
		var audio = new Audio();
		// Получаем список файлов с сервера
		function getFiles() {
			fetch('/getfiles')
				.then(response => {
					return response.json();
				})
				.then(data => {
					// Отображаем список файлов на странице
					for (let i = 0; i < data.length; i++) {
						var li = document.createElement("li");
						var title = document.createTextNode(data[i]);
						li.appendChild(title);
						li.addEventListener("click", function() {
							setSource("audio/" + data[i]);
							audio.play();
						});
						document.getElementById("song-list").appendChild(li);
					}
				});
		}
		// Устанавливаем путь к файлу
		function setSource(src) {
			audio.src = src;
		}

		// Обработчик клика на кнопку "Play"
		document.getElementById("play-button").addEventListener("click", function(){
			audio.play();
		});

		// Обработчик клика на кнопку "Pause"
		document.getElementById("pause-button").addEventListener("click", function(){
			audio.pause();
		});

		// Обработчик клика на кнопку "Stop"
		document.getElementById("stop-button").addEventListener("click", function(){
			audio.pause();
			audio.currentTime = 0;
		});

		// Обработчик отправки формы поиска
		document.getElementById("search-form").addEventListener("submit", function(e) {
			e.preventDefault();
			var searchText = document.getElementById("search-input").value;
			// Выполняем поиск файла на сервере
			fetch('/search?name=' + searchText)
				.then(response => {
					return response.json();
				})
				.then(data => {
					// Если файл найден, то воспроизводим его
					if (data.success) {
						setSource("audio/" + data.file);
						audio.play();
						// Если файл не найден на сервере, то выполняем поиск в интернете
						fetch('/search-internet?name=' + searchText)
							.then(response => {
								return response.json();
							})
							.then(data => {
								// Если файл найден в интернете, то воспроизводим его
								if (data.success) {
									setSource(data.url);
									audio.play();
								} else {
									// Если файл не найден ни на сервере, ни в интернете, то выводим сообщение об ошибке
									alert("Файл не найден"); 
                                } 
                            }) 
                            .catch(error => { 
                                console.error(error); 
                            }); 
                        } 
                        else { 
                            // Если файл не найден на сервере, то выполняем поиск в интернете 
                            fetch('/search-internet?name=' + searchText) 
                            .then(response => { 
                                return response.json(); 
                            }) 
                            .then(data => { 
                                // Если файл найден в интернете, то воспроизводим его 
                                if (data.success) { 
                                    setSource(data.url); audio.play(); 
                                } 
                                else { 
                                    // Если файл не найден ни на сервере, ни в интернете, то выводим сообщение об ошибке 
                                    alert("Файл не найден"); 
                                } 
                            }) 
                            .catch(error => { 
                                console.error(error); 
                            }); 
                        } 
                    }) 
                    .catch(error => { console.error(error); 
                    }); 
                });

	// Получаем список файлов при загрузке страницы
	window.onload = getFiles;
</script>
</body>
</html>
